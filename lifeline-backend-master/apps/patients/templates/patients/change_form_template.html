{% extends "admin/change_form.html" %}
{% load i18n admin_urls admin_static admin_modify material_form material_admin %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="{% static 'patients/css/change_form.css' %}">
<script src="{% static 'patients/js/parse_export.js' %}"></script>
{% endblock %}

{% block object-tools %}
{{ block.super }}
<ul class="object-tools collection with-header download-patient">
    <li class="collection-header"><h5>{% trans 'Export' %}</h5></li>
    {% if generating %}
        <li class="collection-item center">
            <a onclick="location.reload()"
               class="waves-effect waves-light btn btn-primary green white-text patient-export flex-button">
                {% trans "Refresh" %}
                <i class="fa fa-refresh"></i>
            </a>
        </li>
        <li class="collection-item center">
            <a id="disabledLink" disabled="disabled"
               class="waves-effect waves-light btn btn-primary white-text flex-button">{% trans "Generating" %}
                <i class="fa fa-refresh fa-spin"></i>
            </a>
        </li>
        <script>
            setTimeout(() => {location.reload()}, 30000);
        </script>
    {% elif pdf %}
        <li class="collection-item center">
            <div class="waves-effect waves-light btn white-text parse-file flex-button"
               data-url="/{{ LANGUAGE_CODE }}{% url 'patients:export' %}"
               data-object="{{ original.pk }}"
               data-token="{{token}}">{% trans "Regenerate" %}
               <i class="material-icons white-icon">repeat_one</i>
            </div>
        </li>
        <li class="collection-item center">
            <a href="{{ pdf }}" download="export {{ adminform.form.instance.full_name }}.pdf"
               class="waves-effect waves-light btn btn-primary green white-text patient-export flex-button">
                {% trans "Download" %}
                <i class="material-icons white-icon">picture_as_pdf</i>
            </a>
        </li>
        <li class="collection-item">
            <div class="flex">
                <i class="material-icons">person</i>
                <strong>{% trans 'Generated by' %}:</strong>
            </div>
            <span>{{ owner }}</span>
        </li>
    {% else %}
        <li class="collection-item center">
            <div class="waves-effect waves-light btn white-text parse-file flex-button"
               data-url="/{{ LANGUAGE_CODE }}{% url 'patients:export' %}"
               data-object="{{ original.pk }}"
               data-token="{{token}}">{% trans "Generate" %}
               <i class="material-icons white-icon">repeat_one</i>
            </div>
        </li>
    {% endif %}
</ul>
{% endblock %}
